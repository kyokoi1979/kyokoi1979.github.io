<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Vpn on しゃちくWeb</title>
    <link>http://kyokoi1979.github.io/tags/vpn/</link>
    <description>Recent content in Vpn on しゃちくWeb</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <managingEditor>unyu1979@gmail.com (kyokoi)</managingEditor>
    <webMaster>unyu1979@gmail.com (kyokoi)</webMaster>
    <copyright>(C) 2016 kyokoi1979</copyright>
    <lastBuildDate>Thu, 26 Jan 2012 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://kyokoi1979.github.io/tags/vpn/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Vyatta,NetScreenでの拠点間VPN設定(後編)</title>
      <link>http://kyokoi1979.github.io/2012/01/26/vyattanetscreen%E3%81%A7%E3%81%AE%E6%8B%A0%E7%82%B9%E9%96%93vpn%E8%A8%AD%E5%AE%9A%E5%BE%8C%E7%B7%A8/</link>
      <pubDate>Thu, 26 Jan 2012 00:00:00 +0000</pubDate>
      <author>unyu1979@gmail.com (kyokoi)</author>
      <guid>http://kyokoi1979.github.io/2012/01/26/vyattanetscreen%E3%81%A7%E3%81%AE%E6%8B%A0%E7%82%B9%E9%96%93vpn%E8%A8%AD%E5%AE%9A%E5%BE%8C%E7%B7%A8/</guid>
      <description>

&lt;p&gt;前編に引き続き、今回はNetScreen側での設定方法。
構成は前回と同様です。&lt;/p&gt;

&lt;!-- more --&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;p&gt;VPN設定についてはルートベースにしました。&lt;/p&gt;

&lt;h1 id=&#34;初期設定:9e29ad15e7fc57735ad0c5c29ae4a13f&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;シリアルケーブルで接続するか、Trust側のインタフェースに接続してDHCP経由でIPアドレスを取得してtelnetで接続します。
まずuntrustインタフェースのIPアドレス設定とルーティング設定をします。
今回はtrustについてはデフォルトのまま使うので変更しません。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set interface untrust ip 192.168.0.254/24
ns5gt-&amp;gt; set route 0.0.0.0/0 gateway 192.168.0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;トンネルインタフェース作成:9e29ad15e7fc57735ad0c5c29ae4a13f&#34;&gt;トンネルインタフェース作成&lt;/h1&gt;

&lt;p&gt;トンネルインタフェースと、ゾーンを作成します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set zone name VPN
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;次にトンネルインタフェースを作成します。
ゾーンは先程作成したものを指定します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set interface tunnel.1 zone VPN
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;トンネルインタフェースのIPをunnumberedに設定し、untrustインタフェースを割り当てます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set interface tunnel.1 ip unnumbered interface untrust
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;確認するとこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; get interface

A - Active, I - Inactive, U - Up, D - Down, R - Ready

Interfaces in vsys Root:
Name           IP Address         Zone        MAC            VLAN State VSD
trust          192.168.1.1/24     Trust       0010.db85.a6a2    -   U   -
untrust        192.168.0.254/24   Untrust     0010.db85.a6a1    -   U   -
serial         0.0.0.0/0          Null        0010.db85.a6a6    -   D   -
tun.1          unnumbered         VPN         untrust           -   D   -
vlan1          0.0.0.0/0          VLAN        0010.db85.a6af    1   D   -
null           0.0.0.0/0          Null        N/A               -   U   0
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;vpn設定:9e29ad15e7fc57735ad0c5c29ae4a13f&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;PHASE 1設定。
pre shared key, proposalはvyattaで設定したものと同様に。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set ike gateway vyatta-gw address 10.0.0.254 Main outgoing-interface untrust preshare presharedkey proposal pre-g2-aes128-sha
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定。
proposalはvyattaと同様にし、先程作成したトンネルインタフェースをバインドします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set vpn vyatta-ike gateway vyatta-gw no-replay tunnel idletime 0 proposal g2-esp-aes128-sha
ns5gt-&amp;gt; set vpn vyatta-ike monitor source-interface trust destination-ip 10.0.100.1 rekey
ns5gt-&amp;gt; set vpn vyatta-ike id 1 bind interface tunnel.1
ns5gt-&amp;gt; set vpn vyatta-ike proxy-id local-ip 192.168.1.0/24 remote-ip 10.0.100.0/24 ANY
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以上の設定が適用されればIPsec SAがアクティブになるはずです。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; get sa active
Total active sa: 1
total configured sa: 1
HEX ID    Gateway         Port Algorithm     SPI      Life:sec kb Sta   PID vsys
00000001&amp;lt;      10.0.0.254  500 esp:a128/sha1 13a4ad0b  3563 unlim A/U    -1 0
00000001&amp;gt;      10.0.0.254  500 esp:a128/sha1 b73f1236  3563 unlim A/U    -1 0
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;ルーティング設定:9e29ad15e7fc57735ad0c5c29ae4a13f&#34;&gt;ルーティング設定&lt;/h1&gt;

&lt;p&gt;VPN向けのルーティング設定です。
宛て先はトンネルインタフェースになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set route 10.0.100.0/24 interface tunnel.1
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;ポリシー設定:9e29ad15e7fc57735ad0c5c29ae4a13f&#34;&gt;ポリシー設定&lt;/h1&gt;

&lt;p&gt;最後にお好みでポリシー設定をします。
下記は全解放にしています。 :-)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; set policy from trust to VPN any any any permit
ns5gt-&amp;gt; set policy from VPN to trust any any any permit
ns5gt-&amp;gt; save
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;動作確認:9e29ad15e7fc57735ad0c5c29ae4a13f&#34;&gt;動作確認&lt;/h1&gt;

&lt;p&gt;それぞれのルータ配下のマシンからPINGでも打って動作確認します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ns5gt-&amp;gt; ping 10.0.100.1 from trust
Type escape sequence to abort

Sending 5, 100-byte ICMP Echos to 10.0.100.1, timeout is 1 seconds from trust
!!!!!
Success Rate is 100 percent (5/5), round-trip time min/avg/max=3/3/4 ms
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Vyatta,NetScreenでの拠点間VPN設定(前編)</title>
      <link>http://kyokoi1979.github.io/2012/01/25/vyattanetscreen%E3%81%A7%E3%81%AE%E6%8B%A0%E7%82%B9%E9%96%93vpn%E8%A8%AD%E5%AE%9A%E5%89%8D%E7%B7%A8/</link>
      <pubDate>Wed, 25 Jan 2012 00:00:00 +0000</pubDate>
      <author>unyu1979@gmail.com (kyokoi)</author>
      <guid>http://kyokoi1979.github.io/2012/01/25/vyattanetscreen%E3%81%A7%E3%81%AE%E6%8B%A0%E7%82%B9%E9%96%93vpn%E8%A8%AD%E5%AE%9A%E5%89%8D%E7%B7%A8/</guid>
      <description>

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;

&lt;h2 id=&#34;hugoshortcode-1:51131cb4d50388e5c9133630089510a4&#34;&gt;
&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;
&lt;/h2&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;h1 id=&#34;初期設定:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;h2 id=&#34;まず外部向けのインタフェースでvpnを有効にします:51131cb4d50388e5c9133630089510a4&#34;&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/h2&gt;

&lt;hr /&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network-1:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;

&lt;h2 id=&#34;hugoshortcode-3:51131cb4d50388e5c9133630089510a4&#34;&gt;
&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;
&lt;/h2&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network-2:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;h1 id=&#34;初期設定-1:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-1:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;h2 id=&#34;まず外部向けのインタフェースでvpnを有効にします-1:51131cb4d50388e5c9133630089510a4&#34;&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/h2&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network-3:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;

&lt;h2 id=&#34;hugoshortcode-5:51131cb4d50388e5c9133630089510a4&#34;&gt;
&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;
&lt;/h2&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network-4:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;h1 id=&#34;初期設定-2:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-2:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;初期設定-3:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-3:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;初期設定-4:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-4:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network-5:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;

&lt;h2 id=&#34;hugoshortcode-7:51131cb4d50388e5c9133630089510a4&#34;&gt;
&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;
&lt;/h2&gt;

&lt;p&gt;layout: post
title: &amp;laquo;Vyatta,NetScreenでの拠点間VPN設定(前編)&amp;raquo;
date: 2012-01-25
comments: true&lt;/p&gt;

&lt;h2 id=&#34;tags-vyatta-netscreen-vpn-network-6:51131cb4d50388e5c9133630089510a4&#34;&gt;tags: [Vyatta, NetScreen, VPN, Network]&lt;/h2&gt;

&lt;p&gt;Vyatta 6.3とJuniper NetScreen 5GTを用いて拠点間VPN設定をしてみます。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;機種/OS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;OS バージョン&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Vyatta&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;VYATTA CORE 6.3&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Juniper NetScreen 5GT&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;ScreenOS 5.4.0r5.0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;!-- more --&gt;

&lt;p&gt;NetScreenの機種、バージョンが古いですが現行バージョンでも基本的には同じ設定でいけるはずです。﻿
ネットワーク構成は下記の通りとしました。&lt;/p&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;http://kyokoi1979.github.io/images/20120125180313.jpg&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;h1 id=&#34;初期設定-5:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-5:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;初期設定-6:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-6:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;初期設定-7:51131cb4d50388e5c9133630089510a4&#34;&gt;初期設定&lt;/h1&gt;

&lt;p&gt;まず、コンソール経由でVyattaへアクセスし、IPアドレス、ルーティング設定とSSHの有効化をします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta:~$ configure
[edit]
vyatta@vyatta# set interfaces ethernet eth0 address 10.0.0.254/24
vyatta@vyatta# set interfaces ethernet eth1 address 10.0.100.1/24
vyatta@vyatta# set protocols static route 0.0.0.0/0 next-hop 10.0.0.1
vyatta@vyatta# set service ssh
vyatta@vyatta# top
vyatta@vyatta# commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以降はSSH経由で設定します。&lt;/p&gt;

&lt;h1 id=&#34;vpn設定-7:51131cb4d50388e5c9133630089510a4&#34;&gt;VPN設定&lt;/h1&gt;

&lt;p&gt;まず外部向けのインタフェースでVPNを有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# set vpn ipsec ipsec-interfaces interface eth0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 1設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec ike-group ns-ike proposal 1
vyatta@vyatta# set lifetime 28800
vyatta@vyatta# set proposal 1 dh-group 2
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PHASE 2設定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec esp-group ns-esp
vyatta@vyatta# set lifetime 3600
vyatta@vyatta# set pfs enable
vyatta@vyatta# set proposal 1 encryption aes128
vyatta@vyatta# set proposal 1 hash sha1
vyatta@vyatta# top
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にpreshared keyなどを設定して終わり。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# edit vpn ipsec site-to-site peer 192.168.0.254
vyatta@vyatta# set authentication mode pre-shared-secret
vyatta@vyatta# set authentication pre-shared-secret &#39;presharedkey&#39;
vyatta@vyatta# set ike-group ns-ike
vyatta@vyatta# set local-ip 10.0.0.254
vyatta@vyatta# set tunnel 1 esp-group ns-esp
vyatta@vyatta# set tunnel 1 local subnet 10.0.100.0/24
vyatta@vyatta# set tunnel 1 remote subnet 192.168.1.0/24
vyatta@vyatta# commit
vyatta@vyatta# save
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;VPN部分のコンフィグはこんな感じになります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vyatta@vyatta# show vpn ipsec
 esp-group ns-esp {
     lifetime 3600
     pfs enable
     proposal 1 {
         encryption aes128
         hash sha1
     }
 }
 ike-group ns-ike {
     lifetime 28800
     proposal 1 {
         dh-group 2
         encryption aes128
         hash sha1
     }
 }
 ipsec-interfaces {
     interface eth0
 }
 site-to-site {
     peer 192.168.0.254 {
         authentication {
             mode pre-shared-secret
             pre-shared-secret presharedkey
         }
         ike-group ns-ike
         local-ip 10.0.0.254
         tunnel 1 {
             esp-group ns-esp
             local {
                 subnet 10.0.100.0/24
             }
             remote {
                 subnet 192.168.1.0/24
             }
         }
     }
 }
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>