<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ndoutils on しゃちくWeb</title>
    <link>http://kyokoi1979.github.io/tags/ndoutils/</link>
    <description>Recent content in Ndoutils on しゃちくWeb</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <managingEditor>unyu1979@gmail.com (kyokoi)</managingEditor>
    <webMaster>unyu1979@gmail.com (kyokoi)</webMaster>
    <copyright>(C) 2016 kyokoi1979</copyright>
    <lastBuildDate>Tue, 17 Jan 2012 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://kyokoi1979.github.io/tags/ndoutils/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>NDOUtilsのインストール</title>
      <link>http://kyokoi1979.github.io/2012/01/17/ndoutils%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/</link>
      <pubDate>Tue, 17 Jan 2012 00:00:00 +0000</pubDate>
      <author>unyu1979@gmail.com (kyokoi)</author>
      <guid>http://kyokoi1979.github.io/2012/01/17/ndoutils%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/</guid>
      <description>

&lt;p&gt;NDOUtilsではNagiosのデータをデータベースに格納して管理することができます。
&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;詳細は公式サイトを参照してください。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://exchange.nagios.org/directory/Addons/Database-Backends/NDOUtils/details&#34;&gt;http://exchange.nagios.org/directory/Addons/Database-Backends/NDOUtils/details&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;下記はサイトからの引用です。&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;NDOUtils allows you to export current and historical data from one or more Nagios instances to a MySQL database. Several community addons use this as one of their data sources. NDOUtils consists of a standalone daemon, a Nagios event broker, and several helper utilities.
&amp;lt;&amp;lt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;コンパイル-インストール&#34;&gt;コンパイル、インストール&lt;/h1&gt;

&lt;pre&gt;&lt;code&gt;$ curl http://jaist.dl.sourceforge.net/project/nagios/ndoutils-1.x/ndoutils-1.4b9/ndoutils-1.4b9.tar.gz | tar zxv
$ cd ndoutils-1.4b9
$ ./configure

*** Configuration summary for ndoutils 1.4b9 10-27-2009 ***:

 General Options:
 -------------------------
 NDO2DB user:    nagios
 NDO2DB group:   nagios


Review the options above for accuracy.  If they look okay,
type &#39;make&#39; to compile the NDO utilities.

$ make
$ sudo make install

  Hint: NDOUtils Installation against Nagios v3.x
  completed.

  If you want to install NDOUtils for Nagios v2.x
  please type  &#39;make install-2x


  Next step should be the database initialization/upgrade
  cd into the db/ directory and either:
     ./installdb  (for a new installation) or:
     ./upgradedb  (for an existing one)

make[1]: ディレクトリ `/usr/local/src/ndoutils-1.4b9/src&#39; から出ます

Main NDOUtils components installed

&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;データベース作成&#34;&gt;データベース作成&lt;/h1&gt;

&lt;p&gt;次にNDOUtilsで利用するデータベース、ユーザ、パスワードを設定します。(いずれもndoutilsとしました)
READMEには下記の記述があるため権限は制限しました。&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;Create a username/password that has at least the following privileges for the database:&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt;    SELECT, INSERT, UPDATE, DELETE
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&amp;lt;&amp;lt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mysql&amp;gt; CREATE DATABASE ndoutils;
Query OK, 1 row affected (0.00 sec)

mysql&amp;gt; GRANT SELECT,INSERT,UPDATE,DELETE
    -&amp;gt; ON ndoutils.*
    -&amp;gt; TO ndoutils@localhost
    -&amp;gt; IDENTIFIED BY &#39;ndoutils&#39;;
Query OK, 0 rows affected (0.01 sec)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;次にテーブルを作成します。
failedと出ていますが気にしないでおきます :-)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cd db
$ ./installdb -u root -p &amp;quot;&amp;quot; -h localhost -d ndoutils
DBD::mysql::db do failed: Table &#39;ndoutils.nagios_dbversion&#39; doesn&#39;t exist at ./installdb line 51.
** Creating tables for version 1.4b9
     Using mysql.sql for installation...
** Updating table nagios_dbversi
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;モジュール-コンフィグファイルのコピー&#34;&gt;モジュール、コンフィグファイルのコピー&lt;/h1&gt;

&lt;p&gt;broker moduleのコピー。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo cp src/ndomod-3x.o /usr/local/nagios/bin/ndomod.o
$ sudo cp config/ndomod.cfg-sample /usr/local/nagios/etc/ndomod.cfg
$ sudo chown nagios:nagios /usr/local/nagios/etc/ndomod.cfg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;nagiosがbroker moduleを読み込むように設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudi vi /usr/local/nagios/etc/ndomod.cfg
broker_module=/usr/local/nagios/bin/ndomod.o config_file=/usr/local/nagios/etc/ndomod.cfg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ndo2dbのコピー。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo cp src/ndo2db-3x /usr/local/nagios/bin/ndo2db
$ sudo cp config/ndo2db.cfg-sample /usr/local/nagios/etc/ndo2db.cfg
$ sudo chown nagios:nagios /usr/local/nagios/etc/ndo2db.cfg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ndo2dbの設定を先ほど作成したデータベース情報に変更。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo vi /usr/local/nagios/etc/ndo2db.cfg
db_name=ndoutils
db_user=ndoutils
db_pass=ndoutils
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ndo2dbデーモンの起動設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo cp daemon-init /etc/init.d/ndoutils
$ sudo chmod 755 /etc/init.d/ndoutils
$ sudo chkconfig ndoutils on
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後にndo2db,nagiosを起動して終わりです。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo service ndoutils start
$ sudo service nagios restart
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;動作確認&#34;&gt;動作確認&lt;/h1&gt;

&lt;p&gt;正常に動作していればnagiosのログ(/usr/local/nagios/var/nagios.log)に
こんな感じで表示されているはずです。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[1326691682] Nagios 3.3.1 starting... (PID=14465)
[1326691682] Local time is Mon Jan 16 14:28:02 JST 2012
[1326691682] LOG VERSION: 2.0
[1326691682] ndomod: NDOMOD 1.4b9 (10-27-2009) Copyright (c) 2009 Nagios Core Development Team and Community Contributors
[1326691682] ndomod: Successfully connected to data sink.  0 queued items to flush.
[1326691682] Event broker module &#39;/usr/local/nagios/bin/ndomod.o&#39; initialized successfully.
[1326691682] Finished daemonizing... (New PID=14469)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;また、MySQLにもデータが格納されます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mysql&amp;gt; SELECT * FROM ndoutils.nagios_hosts\G
*************************** 1. row ***************************
                          host_id: 2
                      instance_id: 1
                      config_type: 1
                   host_object_id: 1
                            alias: oreore.dtdns.net
                     display_name: oreore.dtdns.net
                          address: 127.0.0.1
          check_command_object_id: 13
               check_command_args:
   eventhandler_command_object_id: 0
        eventhandler_command_args:
notification_timeperiod_object_id: 43
       check_timeperiod_object_id: 2
       failure_prediction_options:
                   check_interval: 1
                   retry_interval: 1
               max_check_attempts: 10
         first_notification_delay: 0
            notification_interval: 120
                   notify_on_down: 1
            notify_on_unreachable: 1
               notify_on_recovery: 1
               notify_on_flapping: 0
               notify_on_downtime: 0
                      stalk_on_up: 0
                    stalk_on_down: 0
             stalk_on_unreachable: 0
           flap_detection_enabled: 1
             flap_detection_on_up: 1
           flap_detection_on_down: 1
    flap_detection_on_unreachable: 1
               low_flap_threshold: 0
              high_flap_threshold: 0
         process_performance_data: 1
         freshness_checks_enabled: 0
              freshness_threshold: 0
           passive_checks_enabled: 1
            event_handler_enabled: 1
            active_checks_enabled: 1
        retain_status_information: 1
     retain_nonstatus_information: 1
            notifications_enabled: 1
                 obsess_over_host: 1
       failure_prediction_enabled: 1
                            notes:
                        notes_url:
                       action_url:
                       icon_image:
                   icon_image_alt:
                       vrml_image:
                  statusmap_image:
                   have_2d_coords: 0
                             x_2d: -1
                             y_2d: 0
                   have_3d_coords: 0
                             x_3d: 0
                             y_3d: 0
                             z_3d: 0
1 row in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>